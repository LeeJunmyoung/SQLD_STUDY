# TCL
1. 트랜잭션은 데이터 베이스의 논리적 연산 단위이다.
2. 하나의 트랜잭션에는 하나 이상의 SQL 문장이 포함된다. 트랜잭션은 분할 할 수 없는 최소의 단위이다. 그렇기 때문에 전부 적용하거나 전부 취소한다. 즉, TRANSACTION은 ALL OR NOTHING의 개념

특성|설명
---|---
원자성(Atomicity)|트랜잭션에서 정의된 연산들은 모두 성공적으로 끝나거나 모두 싫패해야 한다.
일관성(Consistency)|트랜잭션이 실행되기 전의 데이터 베이스의 내용이 잘못되어 있지 않다면 실행된 이후에서 데이터 베이스의 내용에 잘못이 있으면 안된다.
고립성(Isolation)|트랜잭션이 실행되는 도중에 다른 트랜잭션의 영향을 받아 잘못된 결과를 만들어서는 안된다.
지속성(Durability)|트랜잭션이 성공적으로 수행되면 그 트랜잭션이 갱신한 데이터베이스의 내용은 영구적으로 저장된다.

## COMMIT
* 입력한 자료나 수정한 자료에 대해서 또는 삭제한 자료에 대해서 전혀 문제가 없다고 판단 되었을 경우 commit 명령어를 통해서 트랜잭션을 완료 할 수 있다.

### commit이나 rollback 이전의 데이터 상태
1. 단지 메모리 buffer에만 영향을 받았기 때문에 데이터의 변경 이전 상태로 복구 가능하다.
2. 현재 사용자는 SELECT 문장으로 결과를 확인 가능하다.
3. 다른 사용자는 현재 사용자가 수행한 명령의 결과를 볼 수 없다.
4. 변경된 행은 잠금(LOCKING)이 설정되어서 다른 사용자가 변경할 수 없다.

### commit 이후의 상태
1. 데이터에 대한 변경 사항이 데이터 베이스에 반영 된다.
2. 이전 데이터는 영원히 잃어버리게 된다.
3. 모든 사용자는 결과를 볼 수 있다.
4. 관련된 행에 대한 잠금(LOCKING)이 풀리고, 다른 사용자들이 행을 조작할 수 있게 된다.

## ROLLBACK
* 테이블 내 입력한 데이터나, 수정한 데이터, 삭제한 데이터에 대하여 commit 이전에는 변경 사항을 취소할수 있는데 데이터 베이스에서는 롤백(ROLLBACK)기능을 사용한다.
* rollback은 데이터 변경 사항이 취소되어 데이터의 이전 상태로 복구되며, 관련된 행에 대한 잠금(LOCKING)이 풀리고 다른 사용자들이 데이터 변경을 핫ㄹ 수 있게 된다.

## SAVEPOINT
* 저장점(SAVEPOINT)을 정의 하면 rollback할 때 트랜잭션에 포함된 전체 작업을 롤백 하는 것이 아니라 현 시점에서 savepoint 까지 트랜잭션의 일부만 롤백 할 수 있다.
* 복잡한 대규모 트랜잭션에서 에러가 발생했을 때 savepoint 까지의 트랜잭션만 롤백하고 실패한 부분에 대해서만 다시 실행

```
savepoint p1;

rollback to p1;
```

## 트랜잭션 요점
1. 테이블에 데이터의 변경을 발생시키는 insert, update, delete 수행 시 그 변경되는 데이터의 부결성을 보장하는 것이 commit이나 rollback의 목적
2. commit은 변경된 데이터를 영구적으로 반영해라 라는 의미
3. rollback은 변경전으로 복귀하라는 의미
4. savepoint 는 데이터 변경을 사전에 지정한 저장점까지만 롤백하라는 의미
5. oracle의 트랜잭션은 트랜잭션의 대상이 되는 sql 문장을 실행하면 자동으로 시작되고, commit 또는 rollback을 싱행한 시점에서 종료

## commit 및 rollback 처리와는 상관없이 트랜잭션 처리가 일어나는 상황
1. create, alter, drop, rename 등 DDL 문장을 실행하면 그 전후 시점에 자동으로 커밋된다.
2. DML 문장 이후에 커밋없이 DDL 문장이 실행되면 DDL 수행전에 자동으로 커밋 된다.
3. 데이터 베이스를 정상적으로 접속을 종료하면 자동으로 트랜잭션이 커밋된다.
4. 애플리케이션의 이상 종료로 데이터 베이스와의 접속이 단절 되었을 때는 트랜잭션이 자동으로 롤백 된다.