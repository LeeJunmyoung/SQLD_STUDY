# 대량 데이터에 따른 성능

## 대량 데이터 발생에 따른 테이블 분할 개요
* 대량의 데이터가 존재하는 테이블에 많은 트랜잭션이 발생하여 성능이 저하되는 테이블 구조에 대해 수평/수직 분할 설계를 통해 성능 저하를 예방함.

* 테이블의 데이터는 Block 단위로 디스크에 저장 된다.
  - 컬럼이 많아지게 되면 하나의 로우를 저장 시 물리적인 디스크에 여러 블록에 데이터가 저장될 가능성이 높아짐.
  - 하나의 행을 읽더라도 여러 개의 블록을 읽어야 함.
  - 자연스러 해당 SQL 문의 Block I/O가 많아짐.

* 대용량 테이블에서 발생할 수 있는 현상
  |현상명|설명|
  ---|---
  로우 체이닝|로우 길이가 너무 길어서 데이터 블록 하나에 데이터가 모두 저장되지 않고 두 개 이상의 블록에 걸쳐 하나의 로우가 저장되어 있는 형태
  로우 마이그레이션| 데이터 블록에서 수정이 발생하면 수정된 데이터를 해당 데이터 블록에서 저장하지 못하고 다른 블록의 빈공간을 찾아 저장하는 방식

  * 로우 체이닝과 로우 마이그레이션이 발생하여 많은 블록에 데이터가 저장되면 데이터 조회시 절대적인 Block I/O 횟수가 많아지게 됨.
  * Block I/O 횟수가 많아지면 Disk I/O를 할 가능성도 높아짐.
  * Disk I/O를 하게 되는 경우 성능이 급격히 저하 됨.

* 수직 분할
  - 컬럼 단위로 분할하여 I/O를 감소 시킴
  - 한 테이블에 많은 수의 컬럼을 가지고 있는 경우

* 수평 분할
  1. RANGE PARTITION
     - 데이터 보관주기에 따라 테이블에 데이터를 쉽게 지우는 것이 가능하므로 데이터 보관주기에 따른 테이블 관리가 용이
     - 요금 테이블을 요금_년월로 나누어 관리 후 보관 주기 지나면 삭제 가능
  2. LIST PARTITION
     - 특정 값에 따라 분리 저장 할수 있으나 RANGE_PARTITION 과 같이 데이터 보관 주기에 따라 삭제하는 기능은 제공 될 수 없음
     - 차량 관리 테이블에 많은 차량이 등록되어 있을경우 각 차량 모델별로 테이블을 나누어 관리
  3. HASH PARTITION
     - 지정된 HASH 조건에 따라 해싱 알고리즘이 적용되어 테이블이 분리됨.
     - 설계자는 테이블에 데이터가 정확하게 어떻게 들어갔는지 알 수 없음.
     - 성능 향상을 위해 사용하며 데이터 보관주기에 따라 쉽게 삭제하는 기능은 제공 될 수 없다.

  * 테이블에 대한 수평 분할 / 수직 분할의 절차
     1. 데이터 모델링을 완성한다.
     2. 데이터 베이스 용량 산정을 한다
     3. 대량 데이터가 처리되는 테이블에 대해서 트랜잭션 처리 패턴을 분석한다.
     4. 컬럼 단위로 집중화된 처리가 발생하는지, 로우 단위로 집중화된 처리가 발생되는지 분석하여 집중화된 단위로 테이블을 분리하는 것을 검토한다.